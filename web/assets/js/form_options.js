(function(){function f(b){var a=parseInt(b,10);if(isNaN(a))throw Error("The integer value of "+b+" is NaN");return a}var c=window.CvPlsBacklog={};(function(){function b(d){d.preventDefault();window.open(d.currentTarget.href,this.linkTarget)}var a=c.DataTable=function(d,a){this.element=d;this.voteCounter=a;this.voteTypeDisplayStatus={}};a.prototype.element=void 0;a.prototype.voteCounter=void 0;a.prototype.rowCounts=void 0;a.prototype.voteTypeDisplayStatus=void 0;a.prototype.linkTarget="_self";a.prototype.init= function(){var d,a,e,g,k,c,f,h,l=0,m=0;f=b.bind(this);d=this.element.querySelectorAll("tbody tr:not(.error-message)");this.rowCounts={};e=0;for(k=d.length;e<k;e++)for(h=d[e].className,void 0===this.voteTypeDisplayStatus[h]&&(this.voteTypeDisplayStatus[h]=1),void 0===this.rowCounts[h]&&(this.rowCounts[h]=0),this.rowCounts[h]++,a=d[e].querySelectorAll("a"),g=0,c=a.length;g<c;g++)a[g].hasAttribute("data-hasclickhandler")||(a[g].addEventListener("click",f,!1),a[g].setAttribute("data-hasclickhandler", "true"));for(h in this.rowCounts)this.rowCounts.hasOwnProperty(h)&&(m+=this.rowCounts[h],1===this.voteTypeDisplayStatus[h]&&(l+=this.rowCounts[h]));this.voteCounter.setCurrent(l);this.voteCounter.setTotal(m)};a.prototype.hideVoteType=function(a){this.element.classList.contains("hide-"+a)||(this.element.classList.add("hide-"+a),this.voteTypeDisplayStatus[a]=0,void 0!==this.rowCounts[a]&&this.voteCounter.subtractCurrent(this.rowCounts[a]))};a.prototype.showVoteType=function(a){this.element.classList.contains("hide-"+ a)&&(this.element.classList.remove("hide-"+a),this.voteTypeDisplayStatus[a]=1,void 0!==this.rowCounts[a]&&this.voteCounter.addCurrent(this.rowCounts[a]))};a.prototype.setOpenInTabs=function(a){this.linkTarget=a?"_blank":"_self"};a.prototype.refresh=function(a){this.init();a()}})();(function(){function b(a){var b=this.nextRefresh-a;void 0!==this.textNode&&(a=Math.ceil(b/1E3),this.textNode.data=a);this.timeoutHandle=setTimeout(n.bind(this),b%1E3)}function a(){var a=(new Date).getTime();this.nextRefresh= a+1E3*this.interval;b.call(this,a)}function d(){void 0!==this.textNode&&(this.textNode.data="Updating...");this.dataTable.refresh(a.bind(this))}function n(){var a=(new Date).getTime();a>=this.nextRefresh?d.call(this):b.call(this,a)}var e=c.DataTableAutoRefresher=function(a,b){this.dataTable=a;b&&b.firstChild&&b.firstChild instanceof Text&&(this.textNode=b.firstChild)};e.prototype.dataTable=void 0;e.prototype.textNode=void 0;e.prototype.interval=void 0;e.prototype.nextRefresh=void 0;e.prototype.timeoutHandle= void 0;e.prototype.setInterval=function(a){var b;a=f(a);b=a-this.interval;this.interval=a;void 0!==this.timeoutHandle&&b&&(this.nextRefresh+=b)};e.prototype.enable=function(b){void 0===this.timeoutHandle&&(b?d.call(this):a.call(this))};e.prototype.disable=function(){void 0!==this.timeoutHandle&&(clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0)}})();(function(){function b(a){a?(this.dataTableRefresher.setInterval(a),this.dataTableRefresher.enable()):this.dataTableRefresher.disable();this.settingsManager.saveSetting("autoRefreshInterval", a)}function a(){b.call(this,f(this.element.options[this.element.selectedIndex].value))}var d=c.AutoRefreshSelect=function(a,b,d){this.element=a;this.dataTableRefresher=b;this.settingsManager=d};d.prototype.element=void 0;d.prototype.dataTableRefresher=void 0;d.prototype.settingsManager=void 0;d.prototype.init=function(){var d,c,g=this.settingsManager.getSetting("autoRefreshInterval");d=0;for(c=this.element.options.length;d<c;d++)if(f(this.element.options[d].value)===g){this.element.selectedIndex= d;break}void 0!==g&&b.call(this,g);this.element.addEventListener("change",a.bind(this),!1)}})();(function(){var b=c.QuestionCounter=function(a,b){if(!(a&&a.firstChild&&a.firstChild instanceof Text))throw Error("The supplied current element does not have a text node as its first child");this.currentTextNode=a.firstChild;if(!(b&&b.firstChild&&b.firstChild instanceof Text))throw Error("The supplied total element does not have a text node as its first child");this.totalTextNode=b.firstChild};b.prototype.currentTextNode= void 0;b.prototype.totalTextNode=void 0;b.prototype.setCurrent=function(a){this.currentTextNode.data=String(f(a))};b.prototype.setTotal=function(a){this.totalTextNode.data=String(f(a))};b.prototype.getCurrent=function(){return f(this.currentTextNode.data)};b.prototype.addCurrent=function(a){this.currentTextNode.data=String(this.getCurrent()+f(a))};b.prototype.subtractCurrent=function(a){this.currentTextNode.data=String(this.getCurrent()-f(a))}})();(function(){var b=c.SettingsManager=function(a){this.storageEngine= a};b.prototype.storageEngine=void 0;b.prototype.getSetting=function(a){try{return JSON.parse(this.storageEngine.getItem(a))}catch(b){}};b.prototype.saveSetting=function(a,b){this.storageEngine.setItem(a,JSON.stringify(b))}})();(function(){var b=c.Checkbox=function(){};b.prototype.element=void 0;b.prototype.dataTable=void 0;b.prototype.settingsManager=void 0;b.prototype.settingName=void 0;b.prototype.init=function(){this.element.checked=this.getCurrentSetting();this.element.addEventListener("change", this.onChange.bind(this),!1);this.onChange()};b.prototype.reset=function(){this.element.checked=this.element.hasAttribute("checked");this.onChange()};b.prototype.getCurrentSetting=function(){var a=this.settingsManager.getSetting(this.settingName);return"boolean"!==typeof a?this.element.hasAttribute("checked"):Boolean(a)};b.prototype.saveCurrentSetting=function(){this.settingsManager.saveSetting(this.settingName,this.element.checked)}})();(function(){var b=c.LinkTargetCheckbox=function(a,b,c){this.element= a;this.dataTable=b;this.settingsManager=c;this.settingName="linkTarget"};b.prototype=new c.Checkbox;b.prototype.onChange=function(){this.dataTable.setOpenInTabs(this.element.checked);this.saveCurrentSetting()}})();(function(){var b=c.VoteTypeCheckbox=function(a,b,c){this.element=a;this.dataTable=b;this.settingsManager=c;this.voteType=a.id.split("-").pop();this.settingName="voteType-"+this.voteType};b.prototype=new c.Checkbox;b.prototype.voteType=void 0;b.prototype.onChange=function(){this.element.checked? this.dataTable.hideVoteType(this.voteType):this.dataTable.showVoteType(this.voteType);this.saveCurrentSetting()}})();(function(){function b(){var a,b;a=0;for(b=this.controls.length;a<b;a++)this.controls[a].reset()}var a=c.FormResetter=function(a){this.element=a};a.prototype.element=void 0;a.prototype.controls=void 0;a.prototype.init=function(){this.controls=[];this.element.addEventListener("click",b.bind(this),!1)};a.prototype.addControl=function(a){return this.controls.push(a)}})();(function(){var b, a,d,f,e,g,k;d=["cv","delv","ro","rv","adelv"];e=new c.SettingsManager(window.localStorage);f=new c.DataTable(document.getElementById("data-table"),new c.QuestionCounter(document.getElementById("questions-count-current"),document.getElementById("questions-count-total")));f.init();g=new c.FormResetter(document.getElementById("reset-options"));g.init();k=new c.LinkTargetCheckbox(document.getElementById("check-tabs"),f,e);g.addControl(k);k.init();b=0;for(a=d.length;b<a;b++)k=new c.VoteTypeCheckbox(document.getElementById("check-"+ d[b]),f,e),g.addControl(k),k.init();(new c.AutoRefreshSelect(document.getElementById("refresh-interval"),new c.DataTableAutoRefresher(f,document.getElementById("refresh-notice")),e)).init()})()})();
